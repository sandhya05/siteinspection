/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,uselessCode} checked by tsc
 */
import { Injectable, Inject, PLATFORM_ID } from '@angular/core';
import { isPlatformBrowser } from '@angular/common';
import * as i0 from "@angular/core";
/**
 * @record
 */
export function ISimpleSmoothScrollOption() { }
/** @type {?|undefined} */
ISimpleSmoothScrollOption.prototype.duration;
/** @type {?|undefined} */
ISimpleSmoothScrollOption.prototype.easing;
/** @type {?|undefined} */
ISimpleSmoothScrollOption.prototype.offset;
export class SimpleSmoothScrollOption {
    /**
     * @param {?} option
     */
    constructor(option) {
        /**
         * EasingFunctions - from https://gist.github.com/gre/1650294
         */
        this.EasingFunctions = {
            // no easing, no acceleration
            linear: (t) => { return t; },
            // accelerating from zero velocity
            easeInQuad: (t) => { return t * t; },
            // decelerating to zero velocity
            easeOutQuad: (t) => { return t * (2 - t); },
            // acceleration until halfway, then deceleration
            easeInOutQuad: (t) => { return t < .5 ? 2 * t * t : -1 + (4 - 2 * t) * t; },
            // accelerating from zero velocity
            easeInCubic: (t) => { return t * t * t; },
            // decelerating to zero velocity
            easeOutCubic: (t) => { return (--t) * t * t + 1; },
            // acceleration until halfway, then deceleration
            easeInOutCubic: (t) => { return t < .5 ? 4 * t * t * t : (t - 1) * (2 * t - 2) * (2 * t - 2) + 1; },
            // accelerating from zero velocity
            easeInQuart: (t) => { return t * t * t * t; },
            // decelerating to zero velocity
            easeOutQuart: (t) => { return 1 - (--t) * t * t * t; },
            // acceleration until halfway, then deceleration
            easeInOutQuart: (t) => { return t < .5 ? 8 * t * t * t * t : 1 - 8 * (--t) * t * t * t; },
            // accelerating from zero velocity
            easeInQuint: (t) => { return t * t * t * t * t; },
            // decelerating to zero velocity
            easeOutQuint: (t) => { return 1 + (--t) * t * t * t * t; },
            // acceleration until halfway, then deceleration
            easeInOutQuint: (t) => { return t < .5 ? 16 * t * t * t * t * t : 1 + 16 * (--t) * t * t * t * t; }
        };
        this.duration = option.duration || 800;
        this.offset = option.offset || 0;
        this.easing = this.EasingFunctions[option.easing] || this.EasingFunctions['easeInOutQuad'];
    }
}
if (false) {
    /** @type {?} */
    SimpleSmoothScrollOption.prototype.duration;
    /** @type {?} */
    SimpleSmoothScrollOption.prototype.easing;
    /** @type {?} */
    SimpleSmoothScrollOption.prototype.offset;
    /**
     * EasingFunctions - from https://gist.github.com/gre/1650294
     * @type {?}
     */
    SimpleSmoothScrollOption.prototype.EasingFunctions;
}
export class SimpleSmoothScrollService {
    /**
     * @param {?} platformId
     */
    constructor(platformId) {
        this.platformId = platformId;
    }
    /**
     * @param {?} height
     * @param {?} opt
     * @return {?}
     */
    smoothScroll(height, opt) {
        if (isPlatformBrowser(this.platformId)) {
            /** @type {?} */
            const option = new SimpleSmoothScrollOption(opt);
            /** @type {?} */
            const duration = option.duration;
            /** @type {?} */
            const doc = document.documentElement;
            /** @type {?} */
            const begin = (window.pageYOffset || doc.scrollTop) - (doc.clientTop || 0);
            /** @type {?} */
            const t = 10;
            /** @type {?} */
            const tick = 1 / (duration / t);
            height += option.offset;
            /** @type {?} */
            const distance = height - begin;
            if (distance == 0)
                return;
            /** @type {?} */
            let time = 0;
            /** @type {?} */
            let y;
            /** @type {?} */
            let current;
            /** @type {?} */
            let s = setInterval(function () {
                y = option.easing(time);
                current = y * distance + begin;
                if (current >= height && distance > 0) {
                    current = height;
                    clearInterval(s);
                }
                if (current < height + tick && distance < 0) {
                    current = height;
                    clearInterval(s);
                }
                if (current < 0 && distance < 0) {
                    current = 0;
                    clearInterval(s);
                }
                window.scrollTo(0, current);
                time += tick;
            }, t);
        }
    }
    /**
     * @param {?=} opt
     * @return {?}
     */
    smoothScrollToTop(opt = {}) {
        this.smoothScroll(0, opt);
    }
    /**
     * @param {?=} opt
     * @return {?}
     */
    smoothScrollToAnchor(opt = {}) {
        if (isPlatformBrowser(this.platformId)) {
            /** @type {?} */
            let eid = window.location.hash;
            if (eid)
                eid = eid.replace('#', '');
            /** @type {?} */
            let target = document.getElementById(eid);
            if (target)
                this.smoothScroll(target.offsetTop, opt);
        }
    }
}
SimpleSmoothScrollService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
SimpleSmoothScrollService.ctorParameters = () => [
    { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
];
/** @nocollapse */ SimpleSmoothScrollService.ngInjectableDef = i0.defineInjectable({ factory: function SimpleSmoothScrollService_Factory() { return new SimpleSmoothScrollService(i0.inject(i0.PLATFORM_ID)); }, token: SimpleSmoothScrollService, providedIn: "root" });
if (false) {
    /** @type {?} */
    SimpleSmoothScrollService.prototype.platformId;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmcyLXNpbXBsZS1zbW9vdGgtc2Nyb2xsLnNlcnZpY2UuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9uZzItc2ltcGxlLXNtb290aC1zY3JvbGwvIiwic291cmNlcyI6WyJsaWIvbmcyLXNpbXBsZS1zbW9vdGgtc2Nyb2xsLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLFdBQVcsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNoRSxPQUFPLEVBQUUsaUJBQWlCLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQzs7Ozs7Ozs7Ozs7O0FBUXBELE1BQU07Ozs7SUFLSixZQUFZLE1BQWlDOzs7OytCQVNuQjs7WUFFeEIsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsR0FBRyxPQUFPLENBQUMsQ0FBQSxFQUFFOztZQUUzQixVQUFVLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQSxFQUFFOztZQUVuQyxXQUFXLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFBLEVBQUU7O1lBRTFDLGFBQWEsRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLEdBQUcsT0FBTyxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQSxFQUFFOztZQUUxRSxXQUFXLEVBQUUsQ0FBQyxDQUFDLEVBQUUsRUFBRSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUEsRUFBRTs7WUFFeEMsWUFBWSxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsR0FBRyxPQUFPLENBQUMsRUFBRSxDQUFDLENB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QUMsQ0FBQztTQUNQOzs7Ozs7SUFHSSxpQkFBaUIsQ0FBQyxNQUFpQyxFQUFFO1FBQzFELElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxDQUFDOzs7Ozs7SUFHckIsb0JBQW9CLENBQUMsTUFBaUMsRUFBRTtRQUM3RCxJQUFJLGlCQUFpQixDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsRUFBRTs7WUFDdEMsSUFBSSxHQUFHLEdBQUcsTUFBTSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUM7WUFDL0IsSUFBSSxHQUFHO2dCQUNMLEdBQUcsR0FBRyxHQUFHLENBQUMsT0FBTyxDQUFDLEdBQUcsRUFBRSxFQUFFLENBQUMsQ0FBQzs7WUFDN0IsSUFBSSxNQUFNLEdBQUcsUUFBUSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQztZQUMxQyxJQUFJLE1BQU07Z0JBQ1IsSUFBSSxDQUFDLFlBQVksQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1NBQzVDOzs7O1lBckRKLFVBQVUsU0FBQztnQkFDVixVQUFVLEVBQUUsTUFBTTthQUNuQjs7OztZQUdzRCxNQUFNLHVCQUE5QyxNQUFNLFNBQUMsV0FBVyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEluamVjdGFibGUsIEluamVjdCwgUExBVEZPUk1fSUQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IGlzUGxhdGZvcm1Ccm93c2VyIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcblxuZXhwb3J0IGludGVyZmFjZSBJU2ltcGxlU21vb3RoU2Nyb2xsT3B0aW9uIHtcbiAgZHVyYXRpb24/OiBudW1iZXI7XG4gIGVhc2luZz86ICdsaW5lYXInIHwgJ2Vhc2VJblF1YWQnIHwgJ2Vhc2VPdXRRdWFkJyB8ICdlYXNlSW5PdXRRdWFkJyB8ICdlYXNlSW5DdWJpYycgfCAnZWFzZU91dEN1YmljJyB8ICdlYXNlSW5PdXRDdWJpYycgfCAnZWFzZUluUXVhcnQnIHwgJ2Vhc2VPdXRRdWFydCcgfCAnZWFzZUluT3V0UXVhcnQnIHwgJ2Vhc2VJblF1aW50JyB8ICdlYXNlT3V0UXVpbnQnIHwgJ2Vhc2VJbk91dFF1aW50JztcbiAgb2Zmc2V0PzogbnVtYmVyO1xufVxuXG5leHBvcnQgY2xhc3MgU2ltcGxlU21vb3RoU2Nyb2xsT3B0aW9uIHtcbiAgcHVibGljIGR1cmF0aW9uOiBudW1iZXI7XG4gIHB1YmxpYyBlYXNpbmc6IGFueTtcbiAgcHVibGljIG9mZnNldDogYW55O1xuXG4gIGNvbnN0cnVjdG9yKG9wdGlvbjogSVNpbXBsZVNtb290aFNjcm9sbE9wdGlvbikge1xuICAgIHRoaXMuZHVyYXRpb24gPSBvcHRpb24uZHVyYXRpb24gfHwgODAwO1xuICAgIHRoaXMub2Zmc2V0ID0gb3B0aW9uLm9mZnNldCB8fCAwO1xuICAgIHRoaXMuZWFzaW5nID0gdGhpcy5FYXNpbmdGdW5jdGlvbnNbb3B0aW9uLmVhc2luZ10gfHwgdGhpcy5FYXNpbmdGdW5jdGlvbnNbJ2Vhc2VJbk91dFF1YWQnXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFYXNpbmdGdW5jdGlvbnMgLSBmcm9tIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL2dyZS8xNjUwMjk0XG4gICAqL1xuICBwcml2YXRlIEVhc2luZ0Z1bmN0aW9ucyA9IHtcbiAgICAvLyBubyBlYXNpbmcsIG5vIGFjY2VsZXJhdGlvblxuICAgIGxpbmVhcjogKHQpID0+IHsgcmV0dXJuIHQgfSxcbiAgICAvLyBhY2NlbGVyYXRpbmcgZnJvbSB6ZXJvIHZlbG9jaXR5XG4gICAgZWFzZUluUXVhZDogKHQpID0+IHsgcmV0dXJuIHQgKiB0IH0sXG4gICAgLy8gZGVjZWxlcmF0aW5nIHRvIHplcm8gdmVsb2NpdHlcbiAgICBlYXNlT3V0UXVhZDogKHQpID0+IHsgcmV0dXJuIHQgKiAoMiAtIHQpIH0sXG4gICAgLy8gYWNjZWxlcmF0aW9uIHVudGlsIGhhbGZ3YXksIHRoZW4gZGVjZWxlcmF0aW9uXG4gICAgZWFzZUluT3V0UXVhZDogKHQpID0+IHsgcmV0dXJuIHQgPCAuNSA/IDIgKiB0ICogdCA6IC0xICsgKDQgLSAyICogdCkgKiB0IH0sXG4gICAgLy8gYWNjZWxlcmF0aW5nIGZyb20gemVybyB2ZWxvY2l0eSBcbiAgICBlYXNlSW5DdWJpYzogKHQpID0+IHsgcmV0dXJuIHQgKiB0ICogdCB9LFxuICAgIC8vIGRlY2VsZXJhdGluZyB0byB6ZXJvIHZlbG9jaXR5IFxuICAgIGVhc2VPdXRDdWJpYzogKHQpID0+IHsgcmV0dXJuICgtLXQpICogdCAqIHQgKyAxIH0sXG4gICAgLy8gYWNjZWxlcmF0aW9uIHVudGlsIGhhbGZ3YXksIHRoZW4gZGVjZWxlcmF0aW9uIFxuICAgIGVhc2VJbk91dEN1YmljOiAodCkgPT4geyByZXR1cm4gdCA8IC41ID8gNCAqIHQgKiB0ICogdCA6ICh0IC0gMSkgKiAoMiAqIHQgLSAyKSAqICgyICogdCAtIDIpICsgMSB9LFxuICAgIC8vIGFjY2VsZXJhdGluZyBmcm9tIHplcm8gdmVsb2NpdHkgXG4gICAgZWFzZUluUXVhcnQ6ICh0KSA9PiB7IHJldHVybiB0ICogdCAqIHQgKiB0IH0sXG4gICAgLy8gZGVjZWxlcmF0aW5nIHRvIHplcm8gdmVsb2NpdHkgXG4gICAgZWFzZU91dFF1YXJ0OiAodCkgPT4geyByZXR1cm4gMSAtICgtLXQpICogdCAqIHQgKiB0IH0sXG4gICAgLy8gYWNjZWxlcmF0aW9uIHVudGlsIGhhbGZ3YXksIHRoZW4gZGVjZWxlcmF0aW9uXG4gICAgZWFzZUluT3V0UXVhcnQ6ICh0KSA9PiB7IHJldHVybiB0IDwgLjUgPyA4ICogdCAqIHQgKiB0ICogdCA6IDEgLSA4ICogKC0tdCkgKiB0ICogdCAqIHQgfSxcbiAgICAvLyBhY2NlbGVyYXRpbmcgZnJvbSB6ZXJvIHZlbG9jaXR5XG4gICAgZWFzZUluUXVpbnQ6ICh0KSA9PiB7IHJldHVybiB0ICogdCAqIHQgKiB0ICogdCB9LFxuICAgIC8vIGRlY2VsZXJhdGluZyB0byB6ZXJvIHZlbG9jaXR5XG4gICAgZWFzZU91dFF1aW50OiAodCkgPT4geyByZXR1cm4gMSArICgtLXQpICogdCAqIHQgKiB0ICogdCB9LFxuICAgIC8vIGFjY2VsZXJhdGlvbiB1bnRpbCBoYWxmd2F5LCB0aGVuIGRlY2VsZXJhdGlvbiBcbiAgICBlYXNlSW5PdXRRdWludDogKHQpID0+IHsgcmV0dXJuIHQgPCAuNSA/IDE2ICogdCAqIHQgKiB0ICogdCAqIHQgOiAxICsgMTYgKiAoLS10KSAqIHQgKiB0ICogdCAqIHQgfVxuICB9XG59XG5cbkBJbmplY3RhYmxlKHtcbiAgcHJvdmlkZWRJbjogJ3Jvb3QnXG59KVxuZXhwb3J0IGNsYXNzIFNpbXBsZVNtb290aFNjcm9sbFNlcnZpY2Uge1xuXG4gIGNvbnN0cnVjdG9yKEBJbmplY3QoUExBVEZPUk1fSUQpIHByaXZhdGUgcGxhdGZvcm1JZDogT2JqZWN0KSB7IH1cblxuICBwdWJsaWMgc21vb3RoU2Nyb2xsKGhlaWdodDogbnVtYmVyLCBvcHQ6IElTaW1wbGVTbW9vdGhTY3JvbGxPcHRpb24pIHtcbiAgICBpZiAoaXNQbGF0Zm9ybUJyb3dzZXIodGhpcy5wbGF0Zm9ybUlkKSkge1xuICAgICAgY29uc3Qgb3B0aW9uID0gbmV3IFNpbXBsZVNtb290aFNjcm9sbE9wdGlvbihvcHQpO1xuICAgICAgY29uc3QgZHVyYXRpb24gPSBvcHRpb24uZHVyYXRpb247XG4gICAgICBjb25zdCBkb2MgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7XG4gICAgICBjb25zdCBiZWdpbiA9ICh3aW5kb3cucGFnZVlPZmZzZXQgfHwgZG9jLnNjcm9sbFRvcCkgLSAoZG9jLmNsaWVudFRvcCB8fCAwKTtcbiAgICAgIGNvbnN0IHQgPSAxMDtcbiAgICAgIGNvbnN0IHRpY2sgPSAxIC8gKGR1cmF0aW9uIC8gdCk7XG4gICAgICBoZWlnaHQgKz0gb3B0aW9uLm9mZnNldDtcbiAgICAgIGNvbnN0IGRpc3RhbmNlID0gaGVpZ2h0IC0gYmVnaW47XG4gICAgICBpZiAoZGlzdGFuY2UgPT0gMCkgcmV0dXJuO1xuICAgICAgbGV0IHRpbWUgPSAwO1xuICAgICAgbGV0IHksIGN1cnJlbnQ7XG4gICAgICBsZXQgcyA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgeSA9IG9wdGlvbi5lYXNpbmcodGltZSk7XG4gICAgICAgIGN1cnJlbnQgPSB5ICogZGlzdGFuY2UgKyBiZWdpbjtcbiAgICAgICAgaWYgKGN1cnJlbnQgPj0gaGVpZ2h0ICYmIGRpc3RhbmNlID4gMCkge1xuICAgICAgICAgIGN1cnJlbnQgPSBoZWlnaHQ7XG4gICAgICAgICAgY2xlYXJJbnRlcnZhbChzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY3VycmVudCA8IGhlaWdodCArIHRpY2sgJiYgZGlzdGFuY2UgPCAwKSB7XG4gICAgICAgICAgY3VycmVudCA9IGhlaWdodDtcbiAgICAgICAgICBjbGVhckludGVydmFsKHMpO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjdXJyZW50IDwgMCAmJiBkaXN0YW5jZSA8IDApIHtcbiAgICAgICAgICBjdXJyZW50ID0gMDtcbiAgICAgICAgICBjbGVhckludGVydmFsKHMpO1xuICAgICAgICB9XG4gICAgICAgIHdpbmRvdy5zY3JvbGxUbygwLCBjdXJyZW50KTtcbiAgICAgICAgdGltZSArPSB0aWNrO1xuICAgICAgfSwgdCk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHNtb290aFNjcm9sbFRvVG9wKG9wdDogSVNpbXBsZVNtb290aFNjcm9sbE9wdGlvbiA9IHt9KSB7XG4gICAgdGhpcy5zbW9vdGhTY3JvbGwoMCwgb3B0KTtcbiAgfVxuXG4gIHB1YmxpYyBzbW9vdGhTY3JvbGxUb0FuY2hvcihvcHQ6IElTaW1wbGVTbW9vdGhTY3JvbGxPcHRpb24gPSB7fSkge1xuICAgIGlmIChpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtSWQpKSB7XG4gICAgICBsZXQgZWlkID0gd2luZG93LmxvY2F0aW9uLmhhc2g7XG4gICAgICBpZiAoZWlkKVxuICAgICAgICBlaWQgPSBlaWQucmVwbGFjZSgnIycsICcnKTtcbiAgICAgIGxldCB0YXJnZXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlaWQpO1xuICAgICAgaWYgKHRhcmdldClcbiAgICAgICAgdGhpcy5zbW9vdGhTY3JvbGwodGFyZ2V0Lm9mZnNldFRvcCwgb3B0KTtcbiAgICB9XG4gIH1cbn0iXX0=